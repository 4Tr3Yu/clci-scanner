---
import Layout from '../layouts/Layout.astro';
---

<Layout title="CLCI Scanner" description="Scanner for Chilean documents">
	<div class="w-full h-[80vh] flex justify-center flex-col items-center">
		<div class="border border-sky-700">
			<div id="reader" style="width: 300px; height: 300px;"></div>
		</div>
		<button class="p-4 border border-sky-700 rounded-md mr-4 " id="start-qr">Start QR Scanning</button>
		<div id="result"></div>
	</div>
</Layout>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

<script>
//const video = document.getElementById('video') as HTMLVideoElement;
const resultDiv = document.getElementById('result');


const html5QrCode  = new Html5Qrcode("reader");

function startQr() {
	const qrCodeSuccessCallback = (decodedText: any, decodedResult: any) => {
  	console.log("success")
	console.log("decoded", decodedText)  /* handle success */
	console.log("decoded result", decodedResult)  /* handle success */
	const resultElement = document.getElementById("result");
	if (resultElement) {
		resultElement.innerText = `QR Code Result: ${decodedText}`;
	}
	html5QrCode.stop();
};
const qrCodeErrorCallback = (errorMessage: any) => {
	// Handle error if needed
	console.warn(`QR Code scanning error: ${errorMessage}`);
};
	html5QrCode.start(
        { facingMode: "environment" }, // Use the rear camera
        { fps: 60, qrbox: { width: 100, height: 100 }}, // FPS and QR box size
        qrCodeSuccessCallback,
        qrCodeErrorCallback
    ).catch((err: any) => {
        console.error(`Unable to start scanning: ${err}`);
    });
}

const startQrButton = document.getElementById('start-qr');
if (startQrButton) {
	startQrButton.addEventListener('click', startQr);
}
</script>